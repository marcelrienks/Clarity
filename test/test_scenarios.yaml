name: "Clarity Gauge System Comprehensive Tests"
version: 1
author: "Marcel Rienks"

steps:
  # =================================================================
  # 1. SYSTEM STARTUP SCENARIOS (S1.1-S1.5)
  # =================================================================
  
  # S1.1: Clean System Startup
  - name: "S1.1: Clean system startup - boot with no triggers"
    delay: 3000ms
  
  - name: "S1.1: Wait for splash panel to load"
    wait-serial: "SplashPanel"
    
  - name: "S1.1: Wait for splash screen duration" 
    delay: 3000ms
    
  - name: "S1.1: Verify transition to oil panel (default)"
    wait-serial: "OemOilPanel"

  # Reset all triggers to LOW for next test
  - name: "Reset all triggers to LOW"
    set-control:
      part-id: sw1
      control: "1"
      value: 0
  - name: "Reset trigger 2"
    set-control:
      part-id: sw1
      control: "2"
      value: 0
  - name: "Reset trigger 3"
    set-control:
      part-id: sw1
      control: "3"
      value: 0

  # S1.2: Startup with Key Present Active
  - name: "S1.2: Set key_present HIGH before next test"
    set-control:
      part-id: sw1
      control: "1"
      value: 1
      
  - name: "S1.2: Force restart to test startup with active triggers"
    delay: 1000ms
    
  - name: "S1.2: Verify key panel loads after startup"
    wait-serial: "KeyPanel"

  # S1.3: Startup with Key Not Present Active  
  - name: "S1.3: Reset key_present, set key_not_present HIGH"
    set-control:
      part-id: sw1
      control: "1"
      value: 0
  - name: "S1.3: Set key_not_present HIGH"
    set-control:
      part-id: sw1
      control: "2" 
      value: 1
      
  - name: "S1.3: Trigger system restart simulation"
    delay: 1000ms
    
  - name: "S1.3: Verify key panel loads with not present state"
    wait-serial: "KeyPanel"

  # S1.4: Startup with Lock Active
  - name: "S1.4: Reset key triggers, set lock HIGH"
    set-control:
      part-id: sw1
      control: "2"
      value: 0
  - name: "S1.4: Set lock trigger HIGH"
    set-control:
      part-id: sw1
      control: "3"
      value: 1
      
  - name: "S1.4: Trigger system restart simulation"
    delay: 1000ms
    
  - name: "S1.4: Verify lock panel loads after startup"
    wait-serial: "LockPanel"

  # Reset for main scenarios
  - name: "Reset all triggers for main test scenarios"
    set-control:
      part-id: sw1
      control: "3"
      value: 0
      
  - name: "Wait for return to oil panel"
    delay: 3000ms

  # =================================================================
  # 2. SINGLE TRIGGER SCENARIOS (S2.1-S2.4)
  # =================================================================

  # S2.2: Lock Trigger Test
  - name: "S2.2: Test lock trigger LOW → HIGH"
    set-control:
      part-id: sw1
      control: "3"
      value: 1
  
  - name: "S2.2: Verify lock panel loads"
    wait-serial: "LockPanel"
    
  - name: "S2.2: Test lock trigger HIGH → LOW"
    set-control:
      part-id: sw1
      control: "3"
      value: 0
  
  - name: "S2.2: Verify oil panel restored"
    delay: 2000ms

  # S2.3: Key Present Trigger Test
  - name: "S2.3: Test key present trigger LOW → HIGH"
    set-control:
      part-id: sw1
      control: "1"
      value: 1
  
  - name: "S2.3: Verify key panel loads (green)"
    wait-serial: "KeyPanel"
    
  - name: "S2.3: Test key present trigger HIGH → LOW"
    set-control:
      part-id: sw1
      control: "1"
      value: 0
  
  - name: "S2.3: Verify oil panel restored"
    delay: 2000ms

  # S2.4: Key Not Present Trigger Test  
  - name: "S2.4: Test key not present trigger LOW → HIGH"
    set-control:
      part-id: sw1
      control: "2"
      value: 1
  
  - name: "S2.4: Verify key panel loads (red)"
    wait-serial: "KeyPanel"
    
  - name: "S2.4: Test key not present trigger HIGH → LOW"
    set-control:
      part-id: sw1
      control: "2"
      value: 0
  
  - name: "S2.4: Verify oil panel restored"
    delay: 2000ms

  # =================================================================
  # 3. MULTIPLE TRIGGER SCENARIOS (S3.1-S3.5)
  # =================================================================

  # S3.1: Priority Override - Key Present Over Lock
  - name: "S3.1: Activate lock trigger first"
    set-control:
      part-id: sw1
      control: "3"
      value: 1
  
  - name: "S3.1: Verify lock panel loads"
    wait-serial: "LockPanel"
    
  - name: "S3.1: Activate key present (should override lock)"
    set-control:
      part-id: sw1
      control: "1"
      value: 1
  
  - name: "S3.1: Verify key panel overrides lock"
    wait-serial: "KeyPanel"
    
  - name: "S3.1: Deactivate key present (lock should restore)"
    set-control:
      part-id: sw1
      control: "1"
      value: 0
  
  - name: "S3.1: Verify lock panel restored"
    wait-serial: "LockPanel"
    
  - name: "S3.1: Deactivate lock (oil panel should restore)"
    set-control:
      part-id: sw1
      control: "3"
      value: 0
  
  - name: "S3.1: Verify oil panel final restoration"
    delay: 2000ms

  # S3.2: Key Present vs Key Not Present
  - name: "S3.2: Activate key present first"
    set-control:
      part-id: sw1
      control: "1"
      value: 1
  
  - name: "S3.2: Verify key panel (green)"
    wait-serial: "KeyPanel"
    
  - name: "S3.2: Activate key not present (should override, same priority FIFO)"
    set-control:
      part-id: sw1
      control: "2"
      value: 1
  
  - name: "S3.2: Verify key panel switches to red"
    delay: 1000ms
    
  - name: "S3.2: Deactivate key present (not present should remain)"
    set-control:
      part-id: sw1
      control: "1"
      value: 0
  
  - name: "S3.2: Verify key panel stays red"
    delay: 1000ms
    
  - name: "S3.2: Deactivate key not present (oil panel should restore)"
    set-control:
      part-id: sw1
      control: "2"
      value: 0
  
  - name: "S3.2: Verify oil panel restored"
    delay: 2000ms

  # S3.3: Key Not Present vs Key Present (Reverse Order)
  - name: "S3.3: Activate key not present first"
    set-control:
      part-id: sw1
      control: "2"
      value: 1
  
  - name: "S3.3: Verify key panel (red)"
    wait-serial: "KeyPanel"
    
  - name: "S3.3: Activate key present (should override)"
    set-control:
      part-id: sw1
      control: "1"
      value: 1
  
  - name: "S3.3: Verify key panel switches to green"
    delay: 1000ms
    
  - name: "S3.3: Deactivate key not present (present should remain)"
    set-control:
      part-id: sw1
      control: "2"
      value: 0
  
  - name: "S3.3: Verify key panel stays green"
    delay: 1000ms
    
  - name: "S3.3: Deactivate key present (oil panel should restore)"
    set-control:
      part-id: sw1
      control: "1"
      value: 0
  
  - name: "S3.3: Verify oil panel restored"
    delay: 2000ms

  # S3.5: Triple Trigger Activation (Modified - no lights trigger in current hardware)
  - name: "S3.5: Activate lock trigger"
    set-control:
      part-id: sw1
      control: "3"
      value: 1
  
  - name: "S3.5: Verify lock panel"
    wait-serial: "LockPanel"
    
  - name: "S3.5: Activate key present (highest priority)"
    set-control:
      part-id: sw1
      control: "1"
      value: 1
  
  - name: "S3.5: Verify key panel overrides"
    wait-serial: "KeyPanel"
    
  - name: "S3.5: Deactivate key present (lock should restore)"
    set-control:
      part-id: sw1
      control: "1"
      value: 0
  
  - name: "S3.5: Verify lock panel restored"
    wait-serial: "LockPanel"
    
  - name: "S3.5: Deactivate lock (oil panel should restore)"
    set-control:
      part-id: sw1
      control: "3"
      value: 0
  
  - name: "S3.5: Verify oil panel final restoration"
    delay: 2000ms

  # =================================================================
  # 4. EDGE CASE SCENARIOS (S4.1-S4.5)
  # =================================================================

  # S4.5: Invalid Trigger Combinations
  - name: "S4.5: Activate both key triggers simultaneously"
    set-control:
      part-id: sw1
      control: "1"
      value: 1
  - name: "S4.5: Activate key not present"
    set-control:
      part-id: sw1
      control: "2"
      value: 1
  
  - name: "S4.5: Wait and verify system handles invalid state"
    delay: 2000ms
    
  - name: "S4.5: Deactivate key present (not present should remain)"
    set-control:
      part-id: sw1
      control: "1"
      value: 0
  
  - name: "S4.5: Verify key panel (red) from remaining trigger"
    wait-serial: "KeyPanel"
    
  - name: "S4.5: Deactivate key not present"
    set-control:
      part-id: sw1
      control: "2"
      value: 0
  
  - name: "S4.5: Verify oil panel restored"
    delay: 2000ms

  # S4.4: Simultaneous Deactivation Test
  - name: "S4.4: Activate multiple triggers"
    set-control:
      part-id: sw1
      control: "1"
      value: 1
  - name: "S4.4: Activate lock"
    set-control:
      part-id: sw1
      control: "3"
      value: 1
  
  - name: "S4.4: Verify key panel (highest priority)"
    wait-serial: "KeyPanel"
    
  - name: "S4.4: Deactivate all triggers simultaneously"
    set-control:
      part-id: sw1
      control: "1"
      value: 0
  - name: "S4.4: Deactivate lock"
    set-control:
      part-id: sw1
      control: "3"
      value: 0
  
  - name: "S4.4: Verify clean restoration to oil panel"
    delay: 2000ms

  # =================================================================
  # 5. SENSOR TESTING
  # =================================================================

  - name: "Sensor Test: Set low oil pressure (10%)"
    set-control:
      part-id: pot1
      control: value
      value: 0.1
  
  - name: "Wait for pressure sensor reading"
    delay: 1000ms
  
  - name: "Sensor Test: Set high oil pressure (90%)" 
    set-control:
      part-id: pot1
      control: value
      value: 0.9
  
  - name: "Wait for high pressure reading"
    delay: 1000ms

  - name: "Sensor Test: Set oil temperature (50%)"
    set-control:
      part-id: pot2
      control: value
      value: 0.5
  
  - name: "Wait for temperature reading"
    delay: 1000ms

  # =================================================================
  # 6. STRESS AND PERFORMANCE TESTS  
  # =================================================================

  # Rapid toggle test (simulating S4.1-S4.2)
  - name: "Stress Test: Rapid trigger toggle sequence"
    set-control:
      part-id: sw1
      control: "1"
      value: 1
  - name: "Rapid toggle 1"
    set-control:
      part-id: sw1
      control: "1"
      value: 0
  - name: "Rapid toggle 2"
    set-control:
      part-id: sw1
      control: "2"
      value: 1
  - name: "Rapid toggle 3"
    set-control:
      part-id: sw1
      control: "1"
      value: 1
  
  - name: "Wait for system to stabilize"
    delay: 1000ms
  
  - name: "Cleanup rapid toggle test"
    set-control:
      part-id: sw1
      control: "1"
      value: 0
  - name: "Cleanup trigger 2"
    set-control:
      part-id: sw1
      control: "2"
      value: 0

  # =================================================================
  # 7. RESTORATION CHAIN VERIFICATION
  # =================================================================

  # Complex restoration chain test
  - name: "Restoration Test: Build complex trigger stack"
    set-control:
      part-id: sw1
      control: "3"
      value: 1
  - name: "Add key not present"
    set-control:
      part-id: sw1
      control: "2"
      value: 1
  - name: "Add key present (highest priority)"
    set-control:
      part-id: sw1
      control: "1"
      value: 1
  
  - name: "Verify key present panel (green)"
    wait-serial: "KeyPanel"
  
  - name: "Remove key present (should restore to key not present)"
    set-control:
      part-id: sw1
      control: "1"
      value: 0
  
  - name: "Verify key not present panel (red)"
    delay: 1000ms
  
  - name: "Remove key not present (should restore to lock)"
    set-control:
      part-id: sw1
      control: "2"
      value: 0
  
  - name: "Verify lock panel restored"
    wait-serial: "LockPanel"
  
  - name: "Remove lock (should restore to oil panel)"
    set-control:
      part-id: sw1
      control: "3"
      value: 0
  
  - name: "Verify final oil panel restoration"
    delay: 2000ms

  # =================================================================
  # 8. FINAL SYSTEM STABILITY TEST
  # =================================================================

  - name: "Final stability check - system idle"
    delay: 3000ms
    
  - name: "Final verification - oil panel stable"
    delay: 1000ms