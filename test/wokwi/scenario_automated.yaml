name: 'Clarity Automated Integration Test'
version: 1
steps:
  # Step 1: System Startup
  # - Splash panel loads with day theme
  # - Oil panel loads automatically after splash
  - wait-serial: '[T] SplashPanel loaded successfully'
  - wait-serial: '[T] OemOilPanel loaded successfully'
  - delay: 1000ms
  
  # Step 2: Real-time Sensor Interaction
  # Skipped - requires analog pot inputs not available in automation
  
  # Step 3: Theme Change (Non-Blocking Style Trigger)
  # - Night theme applied instantly to Oil Panel
  # - Oil panel continues displaying without reload
  # - STYLE trigger maintains and doesn't block restoration
  - set-control:
      part-id: trigger_btn4  # GPIO 33 - Lights
      control: pressed
      value: 1
  - wait-serial: '[T] LightsOnActivate() - Setting NIGHT theme'
  # Note: Panel should NOT reload, only theme changes
  - delay: 1000ms
  
  # Step 4: Panel Loading Trigger (IMPORTANT Priority)
  # - Lock panel loads with IMPORTANT priority
  # - Lights trigger still active, night theme maintained
  # - Lock panel displays with night theme
  - set-control:
      part-id: trigger_btn3  # GPIO 27 - Lock
      control: pressed
      value: 1
  - wait-serial: '[T] LockEngagedActivate() - Loading LOCK panel'
  - wait-serial: '[T] LockPanel loaded successfully'
  - delay: 1000ms
  
  # Step 5: Higher Priority Key Trigger Override
  # - Key panel loads with CRITICAL priority (overrides lock)
  # - Red key icon displayed with night theme
  - set-control:
      part-id: trigger_btn2  # GPIO 26 - Key Not Present
      control: pressed
      value: 1
  - wait-serial: '[T] KeyNotPresentActivate() - Loading KEY panel'
  - wait-serial: '[T] KeyPanel loaded successfully'
  - wait-serial: '[T] Key icon color set to RED (key not present)'
  - delay: 1000ms
  
  # Step 6: Same Priority Key State Transition
  # - Key panel reloads with green icon
  # - Key Not Present automatically deactivates
  - set-control:
      part-id: trigger_btn1  # GPIO 25 - Key Present
      control: pressed
      value: 1
  - wait-serial: '[T] KeyPresentActivate() - Loading KEY panel'
  - wait-serial: '[T] KeyPanel loaded successfully'
  - wait-serial: '[T] Key icon color set to GREEN (key present)'
  - delay: 1000ms
  
  # Step 7: Key State Reversal and Panel Persistence
  # - Key Not Present already deactivated (automatically when Key Present activated)
  # - Key panel remains with green icon (no state change)
  # Note: This step demonstrates persistence - no action needed
  - delay: 500ms
  
  # Step 8: Priority-Based Restoration Chain
  # - Key Present deactivates → Lock panel loads (restoration)
  # - Lock still active, becomes highest priority
  # - Lock panel displays with night theme
  - set-control:
      part-id: trigger_btn1  # GPIO 25 - Key Present
      control: pressed
      value: 0  # Deactivate
  # Lock panel should be restored since Lock trigger is still active
  - wait-serial: '[T] LockPanel loaded successfully'
  - delay: 1000ms
  
  # Step 9: Error System Integration
  # - Error panel loads with CRITICAL priority
  # - Overrides all other panels
  # - Displays with night theme
  - set-control:
      part-id: btn2  # Debug Error button
      control: pressed
      value: 1
  - delay: 200ms
  - set-control:
      part-id: btn2
      control: pressed
      value: 0
  - wait-serial: '[T] ErrorOccurredActivate() - Loading ERROR panel'
  - wait-serial: '[T] ErrorPanel loaded successfully'
  - delay: 1000ms
  
  # Step 10: Error Navigation
  # - Short press cycles through errors
  - set-control:
      part-id: btn1  # Action button - short press
      control: pressed
      value: 1
  - delay: 200ms
  - set-control:
      part-id: btn1
      control: pressed
      value: 0
  - wait-serial: '[T] ShortPressActivate() - Executing short press action'
  - delay: 500ms
  
  # Step 11: Error Resolution and Priority Restoration
  # - Long press clears errors
  # - Error trigger deactivates
  # - Lock panel loads (next highest priority)
  - set-control:
      part-id: btn1  # Action button - long press
      control: pressed
      value: 1
  - delay: 1500ms
  - set-control:
      part-id: btn1
      control: pressed
      value: 0
  - wait-serial: '[T] LongPressActivate() - Executing long press action'
  # Lock panel should be restored since Lock trigger is still active after error clears
  - wait-serial: '[T] LockPanel loaded successfully'
  - delay: 1000ms
  
  # Step 12: Complete Trigger Chain Restoration
  # - Lock deactivates → Oil panel loads
  # - All PANEL triggers inactive, restore to user panel
  # - Oil panel displays with night theme
  - set-control:
      part-id: trigger_btn3  # GPIO 27 - Lock
      control: pressed
      value: 0  # Deactivate
  - wait-serial: '[T] No blocking interrupts - restoring to ''OemOilPanel'''
  - wait-serial: '[T] OemOilPanel loaded successfully'
  # Oil panel should load with night theme still active
  - delay: 1000ms
  
  # Step 13: Theme Restoration to Day Mode
  # - Day theme applied to Oil Panel
  # - Oil panel continues without reload
  # - Instant theme transition
  - set-control:
      part-id: trigger_btn4  # GPIO 33 - Lights
      control: pressed
      value: 0  # Deactivate (return to day)
  - wait-serial: '[T] LightsOffActivate() - Setting DAY theme'
  # Note: Panel should NOT reload, only theme changes
  - delay: 1000ms
  
  # Step 14: Configuration Access
  # - Long press loads Config panel
  # Note: Config panel may not be fully implemented
  - set-control:
      part-id: btn1  # Action button - long press
      control: pressed
      value: 1
  - delay: 1500ms
  - set-control:
      part-id: btn1
      control: pressed
      value: 0
  - wait-serial: '[T] LongPressActivate() - Executing long press action'
  # If Config panel is implemented, it would load here
  - delay: 1000ms
  
  # Steps 15-20: Configuration Navigation
  # These require Config panel implementation
  # Placeholder for future implementation
  
  # Final cleanup - ensure all triggers are released
  - set-control:
      part-id: trigger_btn1
      control: pressed
      value: 0
  - set-control:
      part-id: trigger_btn2
      control: pressed
      value: 0
  - set-control:
      part-id: trigger_btn3
      control: pressed
      value: 0
  - set-control:
      part-id: trigger_btn4
      control: pressed
      value: 0
  - delay: 1000ms