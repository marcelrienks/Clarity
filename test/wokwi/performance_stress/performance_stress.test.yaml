version: 1
name: "Performance Stress Test"
description: "Test system stability under rapid trigger switching and extended operation"
timeout: 60000

steps:
  - name: "Baseline system startup"
    wait: 4000
    
  - name: "Verify stable initial state"
    expect_text: "Oil panel"
    timeout: 2000
    
  - name: "Capture baseline performance"
    screenshot: "performance_baseline.png"
    delay: 1000
    
  # Performance stress phase - rapid switching simulation
  # Note: Actual rapid switching requires manual DIP switch manipulation
  # This test monitors for stability indicators
  
  - name: "Stress test phase 1: Rapid switching window"
    wait: 5000
    
  - name: "Monitor system stability during stress"
    expect_text: "panel"
    timeout: 5000
    optional: true
    
  - name: "Capture mid-stress state"
    screenshot: "performance_mid_stress.png"
    delay: 1000
    
  - name: "Stress test phase 2: Extended operation"
    wait: 8000
    
  - name: "Verify no error conditions"
    fail_text: "ERROR"
    timeout: 1000
    optional: true
    
  - name: "Monitor memory stability"
    expect_text: "heap"
    timeout: 3000
    optional: true
    
  - name: "Capture extended operation state"
    screenshot: "performance_extended.png"
    delay: 2000
    
  - name: "Stress test phase 3: Recovery verification"
    wait: 5000
    
  - name: "Verify system recovery"
    expect_text: "Oil panel"
    timeout: 3000
    optional: true
    
  - name: "Final stability check"
    wait: 3000
    
  - name: "Capture final performance state"
    screenshot: "performance_test_complete.png"
    delay: 1000

# Manual stress test procedure:
# 1. Rapid DIP switch toggling (simulate rapid trigger changes)
# 2. Quick sequence: #1 ON/OFF, #2 ON/OFF, #3 ON/OFF repeatedly
# 3. Monitor for: memory leaks, display artifacts, crash conditions
# 4. Verify system returns to stable state after stress

performance_criteria:
  - "No memory leaks during rapid switching"
  - "Display remains stable without artifacts"
  - "Panel switching continues to work correctly"
  - "System recovers to stable state after stress"
  - "No error conditions or exceptions"

expect_patterns:
  - "Oil panel"
  - "Free heap"
  - "stable"

# Critical failure conditions for performance
fail_patterns:
  - "[ERROR]"
  - "Exception"
  - "Out of memory"
  - "Watchdog"
  - "Panic"
  - "Guru Meditation"
  - "Stack overflow"