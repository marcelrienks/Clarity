version: 1
name: "Trigger Priority Validation - Enhanced"
description: "Trigger priority testing with conflict resolution"
timeout: 60000ms

steps:
  # Wait for simulation start
  - delay: 2000ms
  
  # Initialize baseline state
  - set-control:
      part-id: sw1
      control: value
      value: 0  # All switches OFF
  - delay: 3000ms
  
  # Verify baseline oil panel
  - wait-serial: "Oil panel"
  - delay: 2000ms
  - wait-serial: "initialized to INACTIVE"
  - delay: 1000ms
  
  # Activate single trigger (Lock - Priority 1)
  - set-control:
      part-id: sw1
      control: value
      value: 4  # Lock trigger only
  - delay: 2000ms
  - wait-serial: "Lock panel"
  - delay: 1000ms
  
  # Add higher priority trigger (Key Present - Priority 0)
  - set-control:
      part-id: sw1
      control: value
      value: 5  # Both Lock and Key Present
  - delay: 2000ms
  - wait-serial: "Key panel"
  - delay: 1000ms
  
  # Test priority cascade - remove highest priority
  - set-control:
      part-id: sw1
      control: value
      value: 4  # Lock only (Priority 1)
  - delay: 2000ms
  - wait-serial: "Lock panel"
  - delay: 1000ms
  
  # Add lights trigger (independent)
  - set-control:
      part-id: sw1
      control: value
      value: 12  # Lock + Lights
  - delay: 2000ms
  - wait-serial: "Night"
  - delay: 1000ms
  
  # Remove all triggers
  - set-control:
      part-id: sw1
      control: value
      value: 0  # All OFF
  - delay: 2000ms
  - wait-serial: "Oil panel"
  - delay: 1000ms