version: 1
name: Clarity Error Condition Tests

steps:
  - name: Wait for system initialization
    delay: 1000ms
  
  - name: Check initial splash screen
    wait-serial: "Panel: SplashPanel"

  - name: Wait for splash completion
    delay: 2000ms
  
  - name: Check oil panel startup
    wait-serial: "Panel: OemOilPanel"

  # Test 1: Sensor failure simulation
  - name: Wait before sensor failure test
    delay: 1000ms
  
  - name: Simulate oil pressure sensor failure (set to minimum)
    set-control: ["pot1", 0.0]  # 0% = sensor failure/minimum reading
  
  - name: Wait for sensor failure detection
    delay: 500ms
  
  - name: Check oil pressure error handling
    wait-serial: "Oil Pressure: ERROR"

  # Test 2: Critical pressure warning
  - name: Wait before pressure warning test
    delay: 1000ms
  
  - name: Set critically low oil pressure
    set-control: ["pot1", 0.05]  # 5% = critically low pressure
  
  - name: Wait for pressure warning
    delay: 500ms
  
  - name: Check pressure warning state
    wait-serial: "Oil Pressure: LOW"

  # Test 3: Temperature sensor failure
  - name: Wait before temperature failure test
    delay: 1000ms
  
  - name: Simulate temperature sensor failure
    set-control: ["pot2", 0.0]  # 0% = sensor failure
  
  - name: Wait for temperature failure detection
    delay: 500ms
  
  - name: Check temperature error handling
    wait-serial: "Oil Temperature: ERROR"

  # Test 4: Overheating condition
  - name: Wait before overheating test
    delay: 1000ms
  
  - name: Set overheating temperature
    set-control: ["pot2", 0.95]  # 95% = overheating condition
  
  - name: Wait for overheating detection
    delay: 500ms
  
  - name: Check overheating warning
    wait-serial: "Oil Temperature: HIGH"

  # Test 5: Dual sensor failure
  - name: Wait before dual failure test
    delay: 1000ms
  
  - name: Set both sensors to failure state
    set-control: ["pot1", 0.0]
  - name: Set temperature sensor to failure
    set-control: ["pot2", 0.0]
  
  - name: Wait for dual failure detection
    delay: 1000ms
  
  - name: Check dual sensor error state
    wait-serial: "Sensor System: FAILED"

  # Test 6: Recovery from sensor failure
  - name: Wait before recovery test
    delay: 1000ms
  
  - name: Restore oil pressure sensor
    set-control: ["pot1", 0.5]  # 50% = normal pressure
  
  - name: Restore temperature sensor
    set-control: ["pot2", 0.4]  # 40% = normal temperature
  
  - name: Wait for sensor recovery
    delay: 1000ms
  
  - name: Check system recovery
    wait-serial: "Panel: OemOilPanel"

  # Test 7: Trigger activation during sensor errors
  - name: Wait before trigger during error test
    delay: 1000ms
  
  - name: Set sensor failure state
    set-control: ["pot1", 0.0]
  
  - name: Activate key present trigger during sensor failure
    set-control: ["sw1", 0, true]
  
  - name: Wait for trigger processing
    delay: 500ms
  
  - name: Check key panel activation despite sensor error
    wait-serial: "Panel: KeyPanel"

  - name: Deactivate key trigger
    set-control: ["sw1", 0, false]
  
  - name: Wait for panel restoration
    delay: 500ms
  
  - name: Check return to oil panel with error state
    wait-serial: "Panel: OemOilPanel"
    
  - name: Final sensor recovery
    set-control: ["pot1", 0.5]
  
  - name: Wait for final recovery
    delay: 500ms
  
  - name: Check final normal state
    wait-serial: "Oil Pressure:"