version: 1
name: "Major Integration Scenario - Fully Automated"
description: "Complete 9-step system integration test with automated DIP switch control"
timeout: 120000ms

steps:
  # Wait for simulation start
  - delay: 2000ms
  
  # Step 1: Initial Startup (all switches OFF)
  - set-control:
      part-id: sw1
      control: value
      value: 0  # All switches OFF
  - delay: 3000ms
  - wait-serial: "Loading splash panel"
  - delay: 2000ms
  - wait-serial: "OEM oil panel"
  - delay: 2000ms
    
  # Step 2: Night Theme Activation (DIP #4 ON = Lights)
  - set-control:
      part-id: sw1
      control: value
      value: 8  # Switch 4 ON (Lights - GPIO 33)
  - delay: 2000ms
  - wait-serial: "theme: Night"
  - delay: 1000ms
    
  # Step 3: Lock Panel Activation (DIP #3 ON = Lock)  
  - set-control:
      part-id: sw1
      control: value
      value: 12  # Switches 3,4 ON (Lock + Lights)
  - delay: 2000ms
  - wait-serial: "Lock panel"
  - delay: 1000ms
    
  # Step 4: Key Not Present (DIP #2 ON = Key Not Present)
  - set-control:
      part-id: sw1
      control: value
      value: 14  # Switches 2,3,4 ON
  - delay: 2000ms
  - wait-serial: "Key panel"
  - delay: 1000ms
    
  # Step 5: Invalid Key State (DIP #1 ON = Key Present + Key Not Present)
  - set-control:
      part-id: sw1
      control: value
      value: 15  # Switches 1,2,3,4 ON (conflict)
  - delay: 2000ms
  - wait-serial: "Lock panel"
  - delay: 1000ms
    
  # Step 6: Key Present State (DIP #2 OFF, #1 remains ON)
  - set-control:
      part-id: sw1
      control: value
      value: 13  # Switches 1,3,4 ON (Key Present + Lock + Lights)
  - delay: 2000ms
  - wait-serial: "Key panel"
  - delay: 1000ms
    
  # Step 7: Return to Lock (DIP #1 OFF)
  - set-control:
      part-id: sw1
      control: value
      value: 12  # Switches 3,4 ON (Lock + Lights)
  - delay: 2000ms
  - wait-serial: "Lock panel"
  - delay: 1000ms
    
  # Step 8: Return to Oil Panel (DIP #3 OFF)
  - set-control:
      part-id: sw1
      control: value
      value: 8  # Switch 4 ON (Lights only)
  - delay: 2000ms
  - wait-serial: "OEM oil panel"
  - delay: 1000ms
    
  # Step 9: Day Theme Restoration (All switches OFF)
  - set-control:
      part-id: sw1
      control: value
      value: 0  # All switches OFF
  - delay: 2000ms
  - wait-serial: "theme: Day"
  - delay: 1000ms

# GPIO Pin Mapping Reference:
# DIP Switch Position -> GPIO Pin -> Function -> Decimal Value
# Position 1 -> GPIO 25 -> Key Present -> 1
# Position 2 -> GPIO 26 -> Key Not Present -> 2  
# Position 3 -> GPIO 27 -> Lock -> 4
# Position 4 -> GPIO 33 -> Lights -> 8