version: 1
name: Clarity Performance Tests

steps:
  - name: Wait for system initialization
    delay: 1000ms
  
  - name: Check splash screen startup time
    wait-serial: "Panel: SplashPanel"

  - name: Wait for splash completion timing
    delay: 2000ms
  
  - name: Check oil panel transition time
    wait-serial: "Panel: OemOilPanel"

  # Performance Test 1: Trigger response time
  - name: Wait before response time test
    delay: 500ms
  
  - name: Activate key trigger and measure response
    set-control: ["sw1", 0, true]
  
  - name: Check fast trigger response (should be immediate)
    wait-serial: "Panel: KeyPanel"
  
  - name: Deactivate trigger quickly
    set-control: ["sw1", 0, false]
  
  - name: Check fast restoration response
    wait-serial: "Panel: OemOilPanel"

  # Performance Test 2: Sensor reading update frequency
  - name: Wait before sensor update test
    delay: 500ms
  
  - name: Change oil pressure rapidly
    set-control: ["pot1", 0.3]
  
  - name: Check sensor update speed
    delay: 200ms
  
  - name: Change pressure again
    set-control: ["pot1", 0.7]
  
  - name: Verify rapid sensor updates
    delay: 200ms
  
  - name: Final pressure change
    set-control: ["pot1", 0.5]
  
  - name: Check final sensor reading
    wait-serial: "Oil Pressure:"

  # Performance Test 3: Multiple rapid trigger changes
  - name: Wait before rapid trigger test
    delay: 500ms
  
  # Rapid sequence of trigger activations
  - name: Trigger sequence start - Key
    set-control: ["sw1", 0, true]
  - name: Quick delay
    delay: 100ms
  - name: Add Lock trigger
    set-control: ["sw1", 2, true]
  - name: Quick delay
    delay: 100ms
  - name: Add Lights trigger
    set-control: ["sw1", 3, true]
  - name: Quick delay
    delay: 100ms
  
  - name: Check system handles rapid changes
    wait-serial: "Panel: KeyPanel"
  
  - name: Verify night theme applied
    wait-serial: "Theme: Night"
  
  # Rapid deactivation sequence
  - name: Quick delay before deactivation
    delay: 100ms
  - name: Deactivate Key (highest priority)
    set-control: ["sw1", 0, false]
  - name: Quick delay
    delay: 100ms
  - name: Check priority shift to Lock
    wait-serial: "Panel: LockPanel"
  
  - name: Deactivate Lock
    set-control: ["sw1", 2, false]
  - name: Quick delay
    delay: 100ms
  - name: Check oil panel restoration
    wait-serial: "Panel: OemOilPanel"
  
  - name: Deactivate Lights
    set-control: ["sw1", 3, false]
  - name: Check theme restoration speed
    wait-serial: "Theme: Day"

  # Performance Test 4: Sensor + Trigger simultaneous changes
  - name: Wait before simultaneous change test
    delay: 500ms
  
  - name: Simultaneous sensor and trigger changes
    set-control: ["pot1", 0.8]     # Change pressure
  - name: Change temperature simultaneously
    set-control: ["pot2", 0.6]     # Change temperature
  - name: Activate trigger simultaneously
    set-control: ["sw1", 0, true]  # Activate key
  
  - name: Check system handles simultaneous changes
    delay: 300ms
  
  - name: Verify key panel activation
    wait-serial: "Panel: KeyPanel"
  
  - name: Deactivate trigger to check sensor readings maintained
    set-control: ["sw1", 0, false]
  
  - name: Check oil panel restoration with updated sensors
    wait-serial: "Panel: OemOilPanel"
  
  - name: Verify sensor readings were maintained during trigger
    wait-serial: "Oil Pressure:"
  
  - name: Verify temperature reading maintained
    wait-serial: "Oil Temperature:"

  # Performance Test 5: Theme switching performance
  - name: Wait before theme performance test
    delay: 500ms
  
  - name: Rapid theme switching - activate lights
    set-control: ["sw1", 3, true]
  
  - name: Check immediate theme change
    wait-serial: "Theme: Night"
  
  - name: Deactivate lights quickly
    set-control: ["sw1", 3, false]
  
  - name: Check immediate theme restoration
    wait-serial: "Theme: Day"
  
  - name: Repeat rapid theme switch
    set-control: ["sw1", 3, true]
  - name: Brief delay
    delay: 50ms
  - name: Quick theme off
    set-control: ["sw1", 3, false]
  - name: Brief delay
    delay: 50ms
  
  - name: Check system stability after rapid theme changes
    wait-serial: "Theme: Day"

  # Performance Test 6: System under continuous load
  - name: Wait before load test
    delay: 500ms
  
  # Create continuous activity
  - name: Start continuous sensor changes
    set-control: ["pot1", 0.2]
  - name: Brief delay
    delay: 100ms
  - name: Continue sensor changes
    set-control: ["pot1", 0.4]
  - name: Add trigger activity
    set-control: ["sw1", 0, true]
  - name: Brief delay
    delay: 100ms
  - name: More sensor changes
    set-control: ["pot1", 0.6]
  - name: Trigger change
    set-control: ["sw1", 0, false]
  - name: Brief delay
    delay: 100ms
  - name: Continue activity
    set-control: ["pot1", 0.8]
  - name: Add lock trigger
    set-control: ["sw1", 2, true]
  - name: Brief delay
    delay: 100ms
  - name: Final sensor change
    set-control: ["pot1", 0.5]
  - name: Clear lock trigger
    set-control: ["sw1", 2, false]
  
  - name: Check system stability under load
    delay: 300ms
  
  - name: Verify final stable state
    wait-serial: "Panel: OemOilPanel"
  
  - name: Verify sensor readings stable
    wait-serial: "Oil Pressure:"

  # Performance Test 7: Recovery time from errors
  - name: Wait before recovery time test
    delay: 500ms
  
  - name: Create error condition quickly
    set-control: ["pot1", 0.0]  # Sensor failure
  
  - name: Wait minimal time for error detection
    delay: 200ms
  
  - name: Recover quickly
    set-control: ["pot1", 0.5]  # Restore sensor
  
  - name: Check fast recovery time
    delay: 300ms
  
  - name: Verify system recovered
    wait-serial: "Oil Pressure:"

  # Final performance verification
  - name: Wait for final state stabilization
    delay: 500ms
  
  - name: Set normal operating conditions
    set-control: ["pot1", 0.5]  # Normal pressure
  - name: Set normal temperature
    set-control: ["pot2", 0.4]  # Normal temperature
  
  - name: Verify final normal operation
    delay: 500ms
  
  - name: Final system state check
    wait-serial: "Panel: OemOilPanel"
  
  - name: Final sensor verification
    wait-serial: "Oil Pressure:"
  
  - name: Final temperature verification
    wait-serial: "Oil Temperature:"